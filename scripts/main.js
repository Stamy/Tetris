"use strict";window.onload=function(){var t=new app.Tetris;document.addEventListener("keydown",function(i){switch(i.keyCode){case 65:t.moveLeft();break;case 68:t.moveRight();break;case 32:t.moveDown();break;case 83:t.rotateRight();break;case 87:t.rotateLeft()}})},function(t){function i(){this.grid=(new app.Grid).generate(),this.figure=new app.Figure,this.xOffset=9,this.yOffset=0,this.grid.isCollision(this.figure.figure,this.yOffset,this.xOffset)}i.prototype.moveDown=function(){var t=this.grid,i=this.figure.figure;this.yOffset<t.rows-i.length?(++this.yOffset,t.isCollision(i,this.yOffset,this.xOffset)||(--this.yOffset,t.addFigure(i,this.yOffset,this.xOffset),this.newFigure())):(t.addFigure(i,this.yOffset,this.xOffset),this.newFigure())},i.prototype.newFigure=function(){this.figure=new app.Figure,this.yOffset=0,this.xOffset=9,this.grid.isCollision(this.figure.figure,this.yOffset,this.xOffset)},i.prototype.moveLeft=function(){var t=this.grid;this.xOffset>0&&(--this.xOffset,t.isCollision(this.figure.figure,this.yOffset,this.xOffset)?this.moveDown():++this.xOffset)},i.prototype.moveRight=function(){var t=this.grid,i=this.figure.figure;this.xOffset<t.columns-i[0].length&&(++this.xOffset,t.isCollision(i,this.yOffset,this.xOffset)?this.moveDown():--this.xOffset)},i.prototype.rotate=function(t){var i=this.grid,e=this.figure.figure;if(e.length+this.xOffset<=i.columns&&e[0].length+this.yOffset<=i.rows){var r=t();i.isCollision(r,this.yOffset,this.xOffset)&&(this.figure.figure=r,this.moveDown())}},i.prototype.rotateLeft=function(){var t=this;this.rotate(function(){return t.figure.rotateLeft()})},i.prototype.rotateRight=function(){var t=this;this.rotate(function(){return t.figure.rotateRight()})},t.app=t.app||{},t.app.Tetris=i}(window),function(t){function i(t,i){this.columns=t||20,this.rows=i||20,this.grid=[]}i.prototype.generate=function(){for(var t=0;t<this.rows;t++){this.grid[t]=[];for(var i=0;i<this.columns;i++)this.grid[t][i]=0}return this},i.prototype.get=function(){return JSON.parse(JSON.stringify(this.grid))},i.prototype.render=function(t){var t=t||this.grid,i="";t.forEach(function(t){i+="*",t.forEach(function(t){i+=0===t?" ":"@"}),i+="*\n"});for(var e=0;e<this.rows+2;e++)i+="*";document.getElementById("tetris").innerHTML=i},i.prototype.isCollision=function(t,i,e){for(var r=this.grid.deepClone(),s=0;s<t.length;s++)for(var f=0;f<t[s].length;f++){if(1===r[s+i][f+e]&&1===t[s][f])return!1;1!==r[s+i][f+e]&&(r[s+i][f+e]=t[s][f])}return this.render(r),r},i.prototype.addFigure=function(t,i,e){for(var r=0;r<t.length;r++)for(var s=0;s<t[r].length;s++)1!==this.grid[r+i][s+e]&&(this.grid[r+i][s+e]=t[r][s])},t.app=t.app||{},t.app.Grid=i}(window),function(t){function i(t){this.figures=t||[[[0,1],[1,1],[1,0]],[[1],[1],[1],[1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,1],[1,1]]],this.random()}i.prototype.random=function(){this.figure=this.figures[Math.floor(Math.random()*this.figures.length)]},i.prototype.rotateLeft=function(){for(var t=this.figure,i=new Array(t[0].length),e=0;e<t[0].length;e++){for(var r=new Array(t.length),s=0;s<t.length;s++)r[s]=t[s][t[0].length-1-e];i[e]=r}return i},i.prototype.rotateRight=function(){for(var t=this.figure,i=new Array(t[0].length),e=0;e<t[0].length;e++){for(var r=new Array(t.length),s=0;s<t.length;s++)r[s]=t[t.length-1-s][e];i[e]=r}return i},t.app=t.app||{},t.app.Figure=i}(window),Array.prototype.deepClone=function(){return JSON.parse(JSON.stringify(this))};